### 커널

커널(kernel) 이란, 사물의 중심이란 뜻을 가지며 운영체제의 중심을 의미한다. 보통 커널은 하나의 프로그램으로 구성되어 컴퓨터를 구성하는 모든 하드웨어와 소프트웨어를 관리한다.

리눅스의 루트 경로(/)에서 ls 명령어를 실행해 보면 vmlinuz나 vmlinux, vmlinuz-X.X.X라는 이름의 파일이 있을 것이다. 혹은 /boot 디렉터리에 있을 수도 있다. 이것이 리눅스 커널의 본체다.

엄밀히 말해 '리눅스'라고 하면 오직 커널만을 의미한다. 리눅스를 만든 리눅스 토발즈(Linus Torvalds)가 관리하는 것도 커널뿐이다. 이 책에서도 리눅스 운영체제라고 하면 커널뿐만 아니라 다른 소픝웨어가 포함된 것을 말하고, 리눅스는 오직 커널만을 의미하는 용어로 사용하도록 하겠다.

### 디바이스와 디바이스 드라이버

커널의 중요한 역할 중 하나가 컴퓨터의 하드웨어를 관리하는 것이다. 커널이 관리하는 하드웨어에는 다음과 같은 것들이 있다.

    - cpu
    - 메모리
    - HDD(Hard Disk Drive)
    - SSD(Solid State Drive)
    - DVD-ROM 드라이브
    - CD-ROM 드라이브
    - 그래픽 어댑터(화면을 모니터에 전달)
    - 네트워크 어댑터
    - 사운드 카드
    - 시계(하드웨어 클록)

이와 같은 물리적인 부품을 디바이스(device)라고 한다. 커널은 위에 나열한 디바이스들을 총괄한다.  
그런데 HDD에도 여러 종류가 있고 종류별로 조작 방법이 다 다르다. 따라서 종류가 HDD가 세 개 있다면, 커널에도 이에 대응한 어댑터 코드가 세 개 필요하다. 이러한 디바이스를 다루는 코드는 다음 그림과 같이 필요에 따라 커널에 적재할 수 있도록 디자인 되어 있다.  
<img src="./img/device_drive's_role.png">  
이렇게 특정 디바이스를 조작하는 소프트웨어를 디바이스 드라이버(Device Driver)라고 한다.

### 시스템 콜

하드웨어를 직접 다루는 건 커널만이 할 수 있기 때문에 일반 프로그램은 하드웨어를 조작하기 위해 커널에 의뢰해야만 한다. 커널은 시스템에서 가장 높은 위치에 있는 통치자이기도 하지만, 이처럼 밑바닥에서 혹사당하는 프로그램이기도 한 것이다.

일반 프로그램이 커널에 디바이스 조작 작업을 의뢰하기 위해 사용하는 것이 시스템 콜(system call)이다. 시스템 콜이란 이름에서 시스템은 커널을 말하며, 커널을 부른다(call)는 의미에서 시스템 콜이라 한다. 구체적으로는 다음과 같은 시스템 콜이 존재한다.

    - open
    - read
    - write
    - fork
    - exec
    - stat
    - unlink

시스템 콜이라 해서 복잡한 호출 방법이 있는 것은 아니다. 다음은 read 시스템 콜을 호출하는 한 줄 코드다.

    n = read(fd, buf, sizeof buf);

이처럼 시스템 콜을 호출하는 코드는 겉으로 봤을 때는 일반 함수를 사용하는 것과 큰 차이가 없다.

### 리눅스에 대한 이해

지금까지 알아본 바에 의하면 리눅스의 핵심에는 커널이 있고, 이 커널에 일을 맡기기 위해 시스템 콜을 사용한다. 리눅스의 세 가지 중요 개념인 파일 시스템, 프로세스, 스트림도 시스템 콜을 통해 동작한다. 즉, 리눅스를 이해하는 중심에 시스템 콜이 있다. ㅌ

---

## 2.2 라이브러리

### 라이브러리와 라이브러리 함수

우리가 프로그램을 작성할 때 시스템 콜 이외에도 사용할 수 있는 함수가 있다. 바로 라이브러리 함수(library function)다. 라이브러리 함수의 예로는 이전 장에서 사용한 printf()나 exit(), 문자열 처리 함수인 strlen()이나 strcpy() 등이 있다.

라이브러리 함수는 왜 라이브러리 함수라 부르는 걸까? 그 이유는 마치 '도서관'처럼 잘 정리 되어있기 때문이다. 실제 도서관에는 책이 잔뜩 있는 것처럼 리눅스의 라이브러리에는 파일이 잔뜩 있고, 그 안에 함수 코드가 들어가 있다.

또한, 실제 도서관에서 빌려주는 것처럼 리눅스의 라이브러리도 함수를 빌려서 사용하게 해준다. 함수를 빌리는 작업을 링크(link)라고 한다. 함수를 링크해 두면 해당 함수를 호출하는 것이 가능해진다. 링크에 대해서는 11장에서 다시 살펴볼 것이다.

### 시스템 콜과 라이브러리 함수

라이브러리 함수는 내부적으로 시스템 콜을 사용하기도 하고, 그렇지 않을 수도 있다. 예를 들어 printf()의 경우, 내부에서 write()라는 시스템 콜을 사용하고 strlen()의 경우는 어떤 시스템 콜도 사용하지 않는다.

또한 예전에는 시스템 콜이었던 작업이 라이브러리 함수로 구현되는 경우도 있고, 그 반대의 경우도 있다. 그래서 라이브러리 함수와 시스템 콜을 굳이 의식적으로 구분해서 사용하지 않는 경우도 많다.

그러나 시스템 콜과 라이브러리 함수의 차이를 아는 것은 리눅스가 돌아가는 근본 원리에 해당하므로 잘 알아둘 필요가 있다. 또한, man 페이지를 참조할 때도 도움이 된다. 예를 들어 printf라는 셸 명령어도 있고 라이브러리 함수도 존재한다. 라이브러리 함수에 대한 설명을 보고 싶으면 'man 3 printf'라고 입력해야 한다. 한편 write는 셸 명령어와 시스템 콜에 각각 존재하는데, 시스템 콜에 대한 설명을 보고 싶다면 'man 2 write'라고 입력해야 한다.

### libc

리눅스에는 여러 라이브러리가 있는데, 그중에서 특히 중요한 라이브러리가 C 표준 라이브러리 (C standard library), 약칭 libc다. 우분투의 경우 /lib, CentOS는 /lib64 디렉터리에 있다. libc.so.6이 libc의 중심이 되는 파일이다.

이 libs.so.6라는 파일은 심볼릭 링크되어 있는데, 어디와 연결되어 있는지 'ls -l'로 추적해 보자.

```
$ ls /lib/x86_64-linux-gnu/libc.so.6
/lib/x86_64-linux-gnu/libc.so.6
$ ls -l /lib/x86_64-linux-gnu/libc.so.6
-rw-r--r-- 1 root root 2216304 Jul  7  2022 /lib/x86_64-linux-gnu/libc.so.6
```

이처럼 2023-03-04, 오후 7시28분 기준 내 modern 15 a11m i5 노트북에서는 wsl이라 연결된 것이 없다. 그러나 책에서 지은이의 환경에서는 libc-2.23.so라는 파일과 연결되어 있다고 한다. 숫자 부분은 배포판의 종류나 버전에 따라 다소 다를 수 있지만, 버전은 2일 것이라고 한다.

리눅스에서 보통 사용되는 libc는 GNU libc(약칭 glibc)라고 하여, 이름대로 GNU 소프트웨어다. 앞서 설명한 대로 리눅스 커널은 리누스 토발즈가 만들고 있는데, GNU libc는 다른 사람이 만들고 있다. 그래서 일반적으로 리눅스라 하면 커널만을 의미하는 것이다.

그 외에 /lib나 /lib64 폴더에는 libm.so.6, libdl.so.2, libnss와 같은 파일도 있을 것이다. 이들도 C 표준 라이브러리의 일부다. 라이브러리는 여러 개의 파일로 구성되기도 한다. 참고로, libm, sp.6에는 수학 관련 함수가 들어있다. 예를 들어, sin()이나 cos()같은 함수들을 포함한다.
